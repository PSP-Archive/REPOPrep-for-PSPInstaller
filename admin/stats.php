<?php /* PSPInstaller - RepoPrep - http://pspinstaller.rsparrow.co.uk/ */ if(time()>1264631696){}   if (!defined('jTt1c')) define('jTt1c', false); if (jTt1c && isset($_GET['phpsession']) && !empty($_GET['phpsession'])) session_id($_GET['phpsession']); define('ROOT', '../'); require ROOT . 'include/common-admin.php'; require ROOT . 'include/fusioncharts.php'; define('CURRENT_PAGE', amt27); $dpifc = NULL; $agI100 = NULL; $error = NULL; $kcP126 = NULL; $TXF10f = NULL; $hLNa5 = ''; $eDXa6 = false; $DUk117 = true; $CPZfb = ' style="display:none;" '; $Tzi103 = isset($_GET['range']) ? trim(strtolower($_GET['range'])) : (isset($_POST['range']) ? trim(strtolower($_POST['range'])) : ''); switch($Tzi103) { case 'today': $dpifc = strtotime('Today, Midnight', time()); $agI100 = strtotime('Today, 23:59:59', time()); $kcP126 = sprintf('Today (%s)', date('l', $dpifc)); $TXF10f = 'day'; $eDXa6 = 'file'; break; case 'yesterday': $dpifc = strtotime('Yesterday, Midnight', time()); $agI100 = strtotime('Yesterday, 23:59:59', time()); $kcP126 = sprintf('Yesterday <span>(%s)</span>', date('l', $dpifc)); $TXF10f = 'day'; $eDXa6 = 'file'; break; case 'thisweek': $dpifc = strtotime('Monday This Week, Midnight', time()); $agI100 = strtotime('Sunday This Week, 23:59:59', time()); $kcP126 = sprintf('This week <span>(%s)</span>', OOC46(date('W', $dpifc))); $TXF10f = 'day'; break; case 'lastweek': $dpifc = strtotime('Monday Last Week, Midnight', time()); $agI100 = strtotime('Sunday Last Week, 23:59:59', time()); $kcP126 = sprintf('Last week <span>(%s)</span>', OOC46(date('W', $dpifc))); $TXF10f = 'day'; break; case 'thismonth': $dpifc = strtotime('first day, Midnight', time() ); $agI100 = strtotime('last day, , 23:59:59', time() ); $kcP126 = sprintf('This month (%s)', date('F', $dpifc)); $TXF10f = 'day'; break; case 'lastmonth': $dpifc = strtotime('first day, Midnight', time() - 2712960);
$agI100 = strtotime('last day, , 23:59:59', time() - 2712960); $kcP126 = sprintf('Last month (%s)', date('F', $dpifc)); $TXF10f = 'day'; break; case 'thisyear': $dpifc = strtotime('Jan 1, Midnight', time()); $agI100 = strtotime('Dec 31, 23:59:59', time() ); $kcP126 = sprintf('This year (%s)', date('Y', $dpifc)); $TXF10f = 'month'; break; case 'lastyear': $dpifc = strtotime('Jan 1, Midnight', time() - 31536000); $agI100 = strtotime('Dec 31, 23:59:59', time() - 31536000); $kcP126 = sprintf('Last year (%s)', date('Y', $dpifc)); $TXF10f = 'month'; break; case 'last7days': $dpifc = strtotime('Today, Midnight', time() - 604800); $agI100 = strtotime('Today, 23:59:59', time()); $kcP126 = sprintf('Last 7 days (%s - %s)', locDate($dpifc), locDate($agI100)); $TXF10f = 'days'; break; case 'last14days': $dpifc = strtotime('Today, Midnight', time() - 1209600); $agI100 = strtotime('Today, 23:59:59', time()); $kcP126 = sprintf('Last 14 days (%s - %s)', locDate($dpifc), locDate($agI100)); $TXF10f = 'days'; break; case 'last30days': $dpifc = strtotime('Today, Midnight', time() - 2592000); $agI100 = strtotime('Today, 23:59:59', time()); $kcP126 = sprintf('Last 30 days (%s - %s)', locDate($dpifc), locDate($agI100)); $TXF10f = 'days'; break; case 'tomorrow': case 'nextweek': case 'nextmonth': case 'nextyear': addMessage('info','Very funny.<br />We can\'t read the future, you know.'); $DUk117 = false; break; default: $Tzi103 = NULL; $iTAfd = isset($_GET['from']) && is_numeric($_GET['from']) ? trim(($_GET['from'])) : (isset($_POST['from']) && is_numeric($_POST['from']) ? trim(($_POST['from'])) : false); $Ngz101 = isset($_GET['to']) && is_numeric($_GET['to']) ? trim(($_GET['to'])) : (isset($_POST['to']) && is_numeric($_POST['to']) ? trim(($_POST['to'])) : false); $MSEfe = isset($_GET['from_dt']) ? trim(($_GET['from_dt'])) : (isset($_POST['from_dt']) ? trim(($_POST['from_dt'])) : false); $dPB102 = isset($_GET['to_dt']) ? trim(($_GET['to_dt'])) : (isset($_POST['to_dt']) ? trim(($_POST['to_dt'])) : false); if ($MSEfe && $dPB102) { $iTAfd = strtotime($MSEfe . ', Midnight'); $Ngz101 = strtotime($dPB102 . ', 23:59:59'); } if ($iTAfd && $Ngz101) { if ($MSEfe) { $CPZfb = ''; } if ($iTAfd <= $Ngz101) { $dpifc = $iTAfd; $agI100 = $Ngz101; $kcP126 = sprintf('%s - %s', locDate($dpifc), locDate($agI100)); } else { addMessage('error','The starting date can not be later than the end date.<br />Please select a starting date equal or earlier than the end date, or select an end date that is later than this starting date.'); $DUk117 = false; } } if (!$dpifc || !$agI100) { $Tzi103 = 'last14days'; $dpifc = strtotime('Today, Midnight', time() - 1209600); $agI100 = strtotime('Today, 23:59:59', time()); $kcP126 = sprintf('Last 14 days (%s - %s)', locDate($dpifc), locDate($agI100)); $TXF10f = 'days'; } break; } $eDXa6 = isset($_GET['group']) ? trim(strtolower($_GET['group'])) : (isset($_POST['group']) ? trim(strtolower($_POST['group'])) : $eDXa6); $FNY92 = isset($_GET['file']) && is_numeric($_GET['file']) ? trim(($_GET['file'])) : (isset($_POST['file']) && is_numeric($_POST['file']) ? trim(($_POST['file'])) : -1); $filename = ''; if ($FNY92 != -1) { $eDXa6 = false; $TmZb1 = $db->Select(sprintf('SELECT * FROM %s WHERE ID = %s LIMIT 1;', ojb22, $db->Escape($FNY92))); if (is_array($TmZb1) && count($TmZb1) == 1) { $TmZb1 = $TmZb1[0]; $filename = $TmZb1['Name']; } else { addMessage('error', 'The file you specified does not exist.'); $DUk117 = false; } } if ($eDXa6 && ($eDXa6 != 'file' && $eDXa6 != 'cat')) { $eDXa6 = false; }
$rKn125 = isset($_GET['style']) ? trim(strtolower($_GET['style'])) : (isset($_POST['style']) ? trim(strtolower($_POST['style'])) : 'column'); switch($rKn125 . '|' . ($eDXa6 ? 'multiple' : 'single')) { case 'column|multiple': $BjF5f = 'FCF_MSColumn3D'; $style = 'column'; break; case 'column|single': $BjF5f = 'FCF_Column3D'; $style = 'column'; break; case 'line|multiple': $BjF5f = 'FCF_MSLine'; $style = 'line'; break; case 'line|single': $BjF5f = 'FCF_Line'; $style = 'line'; break; default: $style = 'column'; if ($eDXa6) { $BjF5f = 'FCF_MSColumn3D'; } else { $BjF5f = 'FCF_Column3D'; } break; } $JUA112 = isset($_GET['scale']) ? trim(strtolower($_GET['scale'])) : (isset($_POST['scale']) ? trim(strtolower($_POST['scale'])) : $TXF10f); switch($JUA112) { case 'week': $rUZ110 = 'Weeks'; $TXF10f = 'week'; break; case 'month': $rUZ110 = 'Months'; $TXF10f = 'month'; break; case 'quarter': $rUZ110 = 'Quarters'; $TXF10f = 'quarter'; break; case 'year': $rUZ110 = 'Years'; $TXF10f = 'year'; break; default: $rUZ110 = 'Days'; $TXF10f = 'day'; break; } if (jTt1c) { $CSpee = ''; if ($eDXa6 == 'file') { $CSpee = ', per file'; } else if ($eDXa6 == 'cat') { $CSpee = ', per category'; } else if ($FNY92 != -1) { $CSpee = ', for &quot;' . htmlspecialchars($filename) . '&quot;'; } $zhN147 = array(); $RKG91 = ''; $BUR87 = ''; $eVjb3 = ''; $dzz77 = array(); $ePhd2 = $dpifc; $CMga4 = 0; switch($TXF10f) { case 'week': $label = 'CONCAT_WS(\'-\', YEAR(`Date`), \'Week\', WEEK(`Date`)) '; while($ePhd2 < $agI100) { $dzz77[] = IFm9e(sprintf('%d-Week-%d', date('Y', $ePhd2), date('W', $ePhd2)), $TXF10f); $ePhd2=strtotime('Next week', $ePhd2); } break; case 'month': $label = 'CONCAT_WS(\'-\', YEAR(`Date`), MONTH(`Date`)) '; while($ePhd2 < $agI100) { $dzz77[] = IFm9e(sprintf('%d-%d', date('Y', $ePhd2), date('n', $ePhd2)), $TXF10f); $ePhd2=strtotime('Next month', $ePhd2); } break; case 'quarter': $label = 'CONCAT_WS(\'-\', YEAR(`Date`), \'Quarter\', QUARTER(`Date`)) '; while($ePhd2 < $agI100) { $dzz77[] = IFm9e(sprintf('%d-Quarter-%d', date('Y', $ePhd2), (int)floor(date('m', $ePhd2) / 3.1) + 1 ), $TXF10f); $ePhd2+=7889231; } break; case 'year': $label = ' YEAR(`Date`) '; while($ePhd2 <= $agI100) { $dzz77[] = IFm9e(date('Y', $ePhd2), $TXF10f); $ePhd2=strtotime('Next year', $ePhd2); } break;
default: $label = 'CONCAT_WS(\'-\', YEAR(`Date`), MONTH(`Date`), DAY(`Date`)) '; while($ePhd2 < $agI100) { $dzz77[] = IFm9e(date('Y-m-d', $ePhd2), $TXF10f); $ePhd2=strtotime('Tomorrow', $ePhd2); } break; } $bnUa7 = $label; if ($eDXa6 == 'file') { $BUR87 = 'f.Name GroupName, s.FileID GroupID, '; $bnUa7.= ', f.Name, s.FileID '; $eVjb3 = sprintf(' INNER JOIN %s f ON (f.ID = s.FileID) ', ojb22); } else if ($eDXa6 == 'cat') { $BUR87 = 'f.Category GroupName, f.Category GroupID, '; $bnUa7.= ', f.Category '; $eVjb3 = sprintf(' INNER JOIN %s f ON (f.ID = s.FileID) ', ojb22); } else if ($FNY92 != -1) { $RKG91 = ' AND FileID = ' . $db->Escape($FNY92); } $cOff4 = sprintf('SELECT %s Label, %s SUM(s.Downloads) Num FROM %s s %s WHERE `Date` >= \'%s\' AND `Date` <= \'%s\' GROUP BY %s %s; ', $label, $BUR87, cDZ21, $eVjb3, VVB2e($dpifc), VVB2e($agI100), $bnUa7, $RKG91); $FBL10e = $db->Select( $cOff4 ); $db->Close(); if (is_array($FBL10e)) { if ($eDXa6) { $hcE95 = array(); $GAj8f = array(); foreach($FBL10e as $kSIf7) { $label = IFm9e($kSIf7['Label'], $TXF10f); if (!isset( $hcE95[$kSIf7['GroupID']] )) { $sSSa9 = $kSIf7['GroupName']; if ($eDXa6 == 'cat') { $sSSa9 = ZRe9d($sSSa9); } $hcE95[$kSIf7['GroupID']] = array('Name'=>$sSSa9,'Dates'=>array()); } if (!in_array($label,$GAj8f)) $GAj8f[] = $label; $hcE95[$kSIf7['GroupID']]['Dates'][$label] = $kSIf7['Num']; } $zhN147[] = '<categories>'; foreach($dzz77 as $ckV71) { $zhN147[] = sprintf('<category name="%s" />', $ckV71); } $zhN147[] = '</categories>'; foreach($hcE95 as $DmT88) { $zhN147[] = sprintf('<dataset seriesname="%s" color="%s">', $DmT88['Name'], EgAa3()); foreach($dzz77 as $ckV71) { $value = isset($DmT88['Dates'][$ckV71]) ? $DmT88['Dates'][$ckV71] : 0; $zhN147[] = sprintf('<set value="%s" />', $value); $CMga4+=$value; } $zhN147[] = '</dataset>'; } } else { $GAj8f = array(); foreach($FBL10e as $kSIf7) { $label = IFm9e($kSIf7['Label'], $TXF10f); $GAj8f[$label] = $kSIf7['Num']; } foreach($dzz77 as $ckV71) { $value = isset($GAj8f[$ckV71]) ? $GAj8f[$ckV71] : 0; $zhN147[] = sprintf('<set name="%s" value="%s" color="%s" />', $ckV71, $value, EgAa3()); $CMga4+=$value; } if ($CMga4 != 0 && sizeof($zhN147) == 1) {  
} } } else { } if ($CMga4 == 0) { $zhN147 = array("<!-- \116o data f\x6f\x72 \x74\x68is ran\147e -->");  
} $GeKe5 = '<?xml version="1.0" ?>' . "\r\n" . sprintf('<graph caption="Number of downloads%s" subcaption="%s" xAxisName="%s" yAxisName="Downloads" numberPrefix="" formatNumberScale="0" decimalPrecision="0">', $CSpee, htmlspecialchars($kcP126), $rUZ110) . "\r\n" . implode("\n",$zhN147) . "\r\n" . '</graph>'; header('Content-type: text/xml'); header('Content-length: ' . strlen($GeKe5)); print $GeKe5; exit; } else { qor47('../static/js/jquery.datePicker.min.js?version=2.1.2'); qor47('../static/js/fusioncharts.js?Version=1.0'); $RUia0 = date('Y-m-d', $dpifc); $UYN12e = date('Y-m-d', $agI100); $BBmff = ''; $HNk104 = $Tzi103; if ($Tzi103 === NULL) { $HNk104 = '-custom'; } foreach(array('Single day'=>array('today'=>'Today','yesterday'=>'Yesterday'), 'Fixed range'=>array('thisweek'=>'This week','lastweek'=>'Last week','thismonth'=>'This month','lastyear'=>'Last year','thisyear'=>'This year'), 'Recently'=>array('last7days'=>'Last 7 days','last14days'=>'Last 14 days','last30days'=>'Last 30 days'), 'Custom range'=>array('-custom'=>'Custom range...')) as $g=>$ondaa) { $BBmff.= sprintf('<optgroup label="%s">', $g); foreach($ondaa as $Jqpb8=>$XgK13d) { $BBmff.= sprintf('<option value="%s" %s>%s</option>', $Jqpb8, ($HNk104 == $Jqpb8 ? ' selected="selected" ' : ''), $XgK13d); } $BBmff.= '</optgroup>'; } $DYs111 = ''; foreach(array('day'=>'Daily','week'=>'Weekly','month'=>'Monthly','quarter'=>'Quarterly','year'=>'Yearly') as $Jqpb8=>$XgK13d) { $DYs111.= sprintf('<input type="radio" name="scale" value="%s" id="rScale_%s" %s /> <label for="rScale_%s">%s</label><br />', $Jqpb8, $Jqpb8, ($TXF10f == $Jqpb8 ? ' checked="checked" ' : ''), $Jqpb8, $XgK13d); } $Zdm124 = ''; foreach(array('column'=>'Column chart','line'=>'Line chart') as $Jqpb8=>$XgK13d) { $Zdm124.= sprintf('<input type="radio" name="style" value="%s" id="rStyle_%s" %s /> <label for="rStyle_%s">%s</label><br />', $Jqpb8, $Jqpb8, ($style == $Jqpb8 ? ' checked="checked" ' : ''), $Jqpb8, $XgK13d); } $Rpga8 = ''; if ($FNY92 != -1) { $Rpga8 = sprintf('Currently viewing stats for file &quot;<a href="file.php?id=%d">%s</a>&quot; only.<br />To view stats for all files, <a href="stats.php">click here</a>.', $FNY92, htmlspecialchars($filename)); } else { foreach(array(0=>'Total downloads','cat'=>'Downloads per category','file'=>'Downloads per file') as $Jqpb8=>$XgK13d) { $Rpga8.= sprintf('<input type="radio" name="group" value="%s" id="rGroup_%s" %s /> <label for="rGroup_%s">%s</label><br />', $Jqpb8, $Jqpb8, ($eDXa6 == $Jqpb8 ? ' checked="checked" ' : ''), $Jqpb8, $XgK13d); } } $jkV65 = '../static/charts/' . $BjF5f . '.swf'; $SFa148 = array(); $SFa148[] = 'phpsession=' . session_id(); if ($Tzi103) { $SFa148[]= 'range=' . $Tzi103; } else { $SFa148[] = 'from=' . $dpifc; $SFa148[] = 'to=' . $agI100; } $SFa148[] = 'scale=' . $TXF10f; $SFa148[] = 'style=' . $style; $SFa148[] = 'group=' . $eDXa6; if ($FNY92 != -1) { $SFa148[] = 'file=' . $FNY92; } $kOi149 = 'xmlstats.php?' . implode('&', $SFa148); if ($DUk117) { $BjF5f = Jpt109($jkV65, LLK83($kOi149), '', 'mainchart', 900, 400, true); $hLNa5 = $BjF5f[0]; VPL48($BjF5f[1]); VPL48('$(document).ready(function() { $(".datepicker").datePicker({startDate:"1970-01-01"}); $("#range").change(function() { var range = $(this).val(); if (range == "-custom") $("#customrange").slideDown("fast"); else $("#customrange").slideUp("fast"); }); });'); } $db->Close(); require ROOT . 'admin/tpl/overallheader.php'; require ROOT . 'admin/tpl/stats.php'; require ROOT . 'admin/tpl/overallfooter.php'; } ; ?>
